# FitCoach — ТЗ v2.0

## 0) Резюме

Кроссплатформенная система с **нативными клиентами для Desktop (Linux/Windows/macOS)** и **iOS (Swift)**. Все данные хранятся на сервере с **FastAPI backend на Python** и **PostgreSQL**. Приложение позволяет отслеживать привычки, здоровье и получать дневные summary от LLM‑наставника (LangChain + OpenAI). Все технологии — **free for enterprise**.

---

## 1) Цели и охват

* **Главная цель**: универсальный трекер здоровья, привычек и активности с мотивационным ИИ‑наставником.
* **Ключевые принципы**: кроссплатформенность, офлайн‑кэш, минимум ручной настройки, безопасность данных.
* **Лицензия/релиз**: open‑source, MIT/Apache‑2.0.
* **Платформы:** Desktop (Linux/Windows/macOS), iOS (нативное приложение).

---

## 2) Архитектура системы

```
┌──────────────────────────────┐
│ Desktop App (Tauri + React) │
│ — локальный кэш (SQLite)    │
│ — REST API → FastAPI        │
└──────────────┬──────────────┘
               │ HTTPS / JWT
┌──────────────▼──────────────┐
│     FastAPI (Python)        │
│ — LangChain + OpenAI        │
│ — SQLAlchemy ORM            │
│ — Auth (JWT)                │
└──────────────┬──────────────┘
               │
┌──────────────▼──────────────┐
│      PostgreSQL (DB)        │
└──────────────┬──────────────┘
               │
┌──────────────▼──────────────┐
│ iOS App (Swift / SwiftUI)   │
│ — CoreData / SQLite кэш     │
│ — REST API → FastAPI        │
└──────────────────────────────┘
```

---

## 3) Основные модули

### 3.1 Карточка дня (основная сущность)

* Дата, тег, самочувствие, оценка усердия.
* Подтаблицы: питание, спорт, вода, сон, настроение, заметки.
* Summary от LLM + итог дня.

### 3.2 Подтаблицы

* **Питание** — категории (завтрак/обед/ужин/перекус), количество, калории, summary.
* **Спорт** — бег/зал/йога; длительность, дистанция, summary.
* **Вода** — визуальная шкала (цель 2,5–3 л), добавление порциями.
* **Сон** — начало/конец, длительность, качество.
* **Настроение** — шкала 1–5, теги (стресс, фокус), заметки.
* **Заметки** — markdown‑редактор.

### 3.3 Статистика

* Графики: вес, километраж, калорийность, вода, сон, «оценка усердия».
* Итоги по неделям/месяцам.

### 3.4 LLM‑наставник

* LangChain + OpenAI API.
* Формирует summary подтаблиц и общий дневной вывод.
* Оценка усердия (0–10) и короткие рекомендации.

### 3.5 Экспорт / Импорт

* Формат JSON, версия схемы, безопасное шифрование.

---

## 4) Desktop‑клиент

| Компонент           | Технология                                    | Назначение                   |
| ------------------- | --------------------------------------------- | ---------------------------- |
| Фреймворк           | **Tauri**                                     | нативная оболочка (MIT)      |
| UI                  | **React + TypeScript + Tailwind + shadcn/ui** | интерфейс, карточки, таблицы |
| ORM (локальный кэш) | **SQLite (Drizzle)**                          | офлайн‑хранилище             |
| Коммуникация        | REST API (fetch/axios)                        | связь с FastAPI              |
| Графики             | Recharts (MIT)                                | визуализация прогресса       |

---

## 5) iOS‑клиент

| Компонент  | Технология                         | Назначение          |
| ---------- | ---------------------------------- | ------------------- |
| Фреймворк  | **Swift + SwiftUI**                | нативный UI         |
| Networking | URLSession / Alamofire (MIT)       | REST API‑клиент     |
| Storage    | CoreData / GRDB.swift (MIT)        | локальный кэш       |
| Charts     | Swift Charts / SwiftUICharts (MIT) | визуализация данных |
| Auth       | Keychain + JWT                     | безопасность        |

---

## 6) Backend (Python)

| Компонент     | Технология                | Назначение                        |
| ------------- | ------------------------- | --------------------------------- |
| Framework     | **FastAPI** (MIT)         | REST API, маршруты                |
| ORM           | **SQLAlchemy + Alembic**  | работа с PostgreSQL               |
| Auth          | **PyJWT / FastAPI Users** | токен‑базированная аутентификация |
| LLM           | **LangChain + OpenAI**    | генерация дневных отчётов         |
| Cache / Queue | **Redis (BSD)**           | кэш summary, очередь задач        |
| Docs          | Swagger / Redoc           | автогенерация API                 |

---

## 7) Database — PostgreSQL

* Схема: Day, Meal, Exercise, WaterLog, SleepLog, MoodLog, LlmSummary.
* JSONB‑поля для history и советов.
* Лицензия PostgreSQL — полностью свободна для enterprise.

---

## 8) Инфраструктура

| Компонент       | Технология           | Назначение                          |
| --------------- | -------------------- | ----------------------------------- |
| Контейнеризация | Docker Compose       | API + DB + Redis                    |
| Reverse Proxy   | Nginx (BSD)          | HTTPS, CORS                         |
| CI/CD           | GitHub Actions       | сборка desktop и iOS, тесты, релизы |
| Мониторинг      | Prometheus + Grafana | производительность                  |

---

## 9) Безопасность и лицензии

* Все зависимости — MIT / Apache‑2.0 / BSD / PostgreSQL License.
* Нет GPL / AGPL компонентов.
* Хранение токенов: Keychain (iOS), keytar (Desktop).
* LLM‑ключ хранится только на сервере.

---

## 10) Roadmap

**M1:** базовый backend (FastAPI + PostgreSQL + LLM summary).
**M2:** Desktop клиент (Tauri + React), REST интеграция.
**M3:** iOS клиент (SwiftUI), подключение к API.
**M4:** графики, кэширование, синхронизация.
**M5:** релиз open‑source, документация, Docker‑compose шаблон.

---

## 11) Критерии готовности MVP

* Рабочие клиенты (Desktop + iOS) с авторизацией.
* Запись и чтение данных с PostgreSQL через FastAPI.
* Генерация дневных summary и оценок.
* Визуализация прогресса и экспорт JSON.
* Полная совместимость лицензий (free for enterprise).
